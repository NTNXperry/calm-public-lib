{
    "tasks":[
        {
            "uid":"574414b20807a3fe5cbd8ed7",
            "classification":"provision_azure",
            "creation_time":1463661934,
            "user_data":null,
            "credential_id":"574414b20807a3fe5cbd8ed6",
            "storage_type":"Standard_GRS",
            "size":"Basic_A1",
            "subnet":"Subnet-1",
            "network":"calmnet",
            "image_type":"os",
            "version":118,
            "location":"East US",
            "editables":[

            ],
            "vm_name":"Percona-@@{CLUSTER_NAME}@@-@@{calm_array_index}@@",
            "data_disk_list":[
                {
                    "logical_disk_size_in_gb":"2",
                    "uid":"573db56e9acaaf75911eaf09",
                    "classification":null,
                    "disk_label":"@@{vm_name}@@-Disk0",
                    "host_caching":"ReadWrite",
                    "lun":"0"
                }
            ],
            "tags":{

            },
            "image_name":"b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_04_4-LTS-amd64-server-20160516-en-us-30GB",
            "modification_time":1465367209,
            "name":"Provision Azure",
            "install_vm_agent":true,
            "shutdown_behavior":"delete",
            "credential_to_feed_vm":"574414b20807a3fe5cbd8ed6",
            "storage_name":"percona@@{CLUSTER_NAME}@@@@{calm_array_index}@@",
            "critical":true,
            "os_type":"Linux"
        },
        {
            "uid":"57453dfd0807a37b9b584f89",
            "classification":"runshell",
            "script":"#!\/bin\/bash\ndistro=$(lsb_release -s -c)\nMYCNFTEMPLATE=\"https:\/\/raw.githubusercontent.com\/ideadevice\/calm-public-lib\/master\/Calm-Sample-Blueprints\/Percona-Cluster\/my.cnf.template\"\nsudo apt-key adv --keyserver keys.gnupg.net --recv-keys 1C4CBDCDCD2EFD2A\npercona_repo=\"\/etc\/apt\/sources.list.d\/percona.list\"\n\nif [ ! -e $percona_repo ]; then\n  echo \"deb http:\/\/repo.percona.com\/apt ${distro} main\n${repo}deb-src http:\/\/repo.percona.com\/apt ${distro} main\" | sudo tee -a $percona_repo\nfi\n\nsudo apt-get -q update\n\nsudo apt-get install wget\n\nexport DEBIAN_FRONTEND='noninteractive'\nsudo -E apt-get install -q -y percona-xtradb-cluster-5.5 mysql-client\nsudo apt-get install -y xinetd\nmysql -u root<<-EOF\nUPDATE mysql.user SET Password=PASSWORD('@@{DB_PASSWORD}@@') WHERE User='root';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nFLUSH PRIVILEGES;\ndrop database test;\nEOF\nsudo wget \"${MYCNFTEMPLATE}\" -O \/etc\/mysql\/my.cnf",
            "creation_time":1464155645,
            "credential_id":"574414b20807a3fe5cbd8ed6",
            "modification_time":1465367209,
            "version":84,
            "critical":false,
            "editables":[

            ],
            "name":"InstallPercona"
        },
        {
            "uid":"57453dfd0807a37b9b584f8a",
            "classification":"runshell",
            "script":"#!\/bin\/bash\nif [ \"@@{calm_array_index}@@\" == \"0\" ];then\n  sudo sed -i \"s\/^wsrep_cluster_address=.*\/wsrep_cluster_address=gcomm:\\\/\\\/\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_node_address=.*\/wsrep_node_address=@@{calm_array_private_ip_address[AZ_INT(calm_array_index)]}@@\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_node_name=.*\/wsrep_node_name=percona@@{calm_array_index}@@\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_sst_auth=.*\/wsrep_sst_auth='@@{SST_USER}@@:@@{SST_PASS}@@'\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_cluster_name=.*\/wsrep_cluster_name='@@{CLUSTER_NAME}@@'\/I\" \/etc\/mysql\/my.cnf\n  sudo service mysql restart\n  echo \"CREATE USER '@@{SST_USER}@@'@'localhost' IDENTIFIED BY '@@{SST_PASS}@@';\" | sudo tee \/tmp\/mysql.sql\n  echo \"GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO '@@{SST_USER}@@'@'localhost';\" | sudo tee -a \/tmp\/mysql.sql\n  echo \"FLUSH PRIVILEGES;\" | sudo tee -a \/tmp\/mysql.sql\n  mysql -u root -p\"@@{DB_PASSWORD}@@\" < \/tmp\/mysql.sql\nelse\n  sleep 10\n  sudo sed -i \"s\/^wsrep_cluster_address=.*\/wsrep_cluster_address=gcomm:\\\/\\\/@@{calm_array_private_ip_address}@@\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_node_address=.*\/wsrep_node_address=@@{calm_array_private_ip_address[AZ_INT(calm_array_index)]}@@\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_node_name=.*\/wsrep_node_name=percona@@{calm_array_index}@@\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_sst_auth=.*\/wsrep_sst_auth='@@{SST_USER}@@:@@{SST_PASS}@@'\/I\" \/etc\/mysql\/my.cnf\n  sudo sed -i \"s\/^wsrep_cluster_name=.*\/wsrep_cluster_name='@@{CLUSTER_NAME}@@'\/I\" \/etc\/mysql\/my.cnf\n  sudo service mysql restart\nfi",
            "creation_time":1464155645,
            "credential_id":"574414b20807a3fe5cbd8ed6",
            "modification_time":1465367209,
            "version":84,
            "critical":false,
            "editables":[

            ],
            "name":"Configure-percona"
        },
        {
            "uid":"57453e610807a37b9b584fe6",
            "classification":"runshell",
            "script":"#!\/bin\/bash\nif [ \"@@{calm_array_index}@@\" ] == \"0\" ;then\n  sudo sed -i \"s\/^wsrep_cluster_address=.*\/wsrep_cluster_address=gcomm:\\\/\\\/@@{calm_array_private_ip_address}@@\/I\" \/etc\/mysql\/my.cnf\n  sudo service mysql restart\nfi",
            "creation_time":1464155745,
            "credential_id":"574414b20807a3fe5cbd8ed6",
            "modification_time":1465367209,
            "version":83,
            "critical":false,
            "editables":[

            ],
            "name":"Final-Reconfiguration"
        },
        {
            "uid":"574811500807a3e881e3f23e",
            "classification":"runshell",
            "script":"#!\/bin\/bash\nif [ \"@@{calm_array_index}@@\" == \"0\"];then\n  sudo rm -rf \/tmp\/mysql-temp\n  DATE=$(date -u \"+%F-%H%M%S\")\n  FILE_NAME=@@{DB_NAME}@@-${DATE}\n  sudo mkdir -p \/tmp\/mysql-temp\n  sudo su - -c \"mysqldump --opt -u root -p\\\"@@{PASSWORD}@@\\\" @@{DB_NAME}@@ > \/tmp\/mysql-temp\/${FILE_NAME}.sql\"\n  sudo tar -zcvf backup\/${FILE_NAME}.tar.gz \/tmp\/mysql-temp\/${FILE_NAME}.sql\nfi",
            "creation_time":1464340816,
            "credential_id":"574414b20807a3fe5cbd8ed6",
            "modification_time":1465367209,
            "version":4,
            "critical":false,
            "editables":[

            ],
            "name":"Backup"
        },
        {
            "uid":"574811850807a3ede9877340",
            "classification":"runshell",
            "script":"#!\/bin\/bash\nif [ \"@@{calm_array_index}@@\" == \"0\"];then\n  latest_backup=$(cd backup ; ls -dt @@{DB_NAME}@@-*.tar.gz | head -1)\n  if [ $latest_backup = \"\" ];then\n    echo \"No backups available\"\n    exit 1\n  fi\n  tar -zxvf backup\/${latest_backup} -C \/tmp\/\n  filename=$(basename \"${latest_backup}\")\n  filename=\"${filename%.*.*}\"\n  echo \"CREATE DATABASE IF NOT EXISTS @@{DB_NAME}@@;\" | sudo tee \/tmp\/createdb.sql\n  sudo su - -c \"mysql -u root -p\\\"@@{PASSWORD}@@\\\" < \/tmp\/createdb.sql\"\n  sudo su - -c \"mysql -u root -p\\\"@@{PASSWORD}@@\\\"  @@{DB_NAME}@@ < \/tmp\/tmp\/mysql-temp\/${filename}.sql\"\nfi\n",
            "creation_time":1464340869,
            "credential_id":"574414b20807a3fe5cbd8ed6",
            "modification_time":1465367209,
            "version":3,
            "critical":false,
            "editables":[

            ],
            "name":"Restore"
        }
    ],
    "uid":"574414b20807a3fe5cbd8edb",
    "classification":"blueprint",
    "autoscale_config":{
        "post_flow":null,
        "cool_down_period":"1800",
        "uid":"573db4ad9acaaf75911eaadf",
        "classification":null,
        "alert_count":"1",
        "max_count":"1",
        "pre_flow":null,
        "min_count":"1",
        "listen_for":"external",
        "scale_by":"1",
        "alert_window":"1800"
    },
    "cost":0.0,
    "strategy_enabled":false,
    "environment":"default",
    "provider":null,
    "config":{
        "setup":[

        ],
        "uid":"573db4ad9acaaf75911eaae0",
        "classification":null,
        "deploy":[

        ]
    },
    "calm-version":"1.7.2",
    "description":null,
    "parent":null,
    "flows":[
        {
            "tasks":[
                {
                    "task_id":"574811850807a3ede9877340",
                    "rc_id":"cid:00000001",
                    "uid":"574811850807a3ede9877341",
                    "classification":null
                }
            ],
            "uid":"cid:00000002",
            "classification":null,
            "eta":-1,
            "creation_time":1464340869,
            "edges":[

            ],
            "has_critical_tasks":false,
            "modification_time":1465367209,
            "version":0,
            "flow_type":null,
            "critical":false,
            "name":"Restore"
        },
        {
            "tasks":[
                {
                    "task_id":"574811500807a3e881e3f23e",
                    "rc_id":"cid:00000001",
                    "uid":"574811500807a3e881e3f23f",
                    "classification":null
                }
            ],
            "uid":"cid:00000003",
            "classification":null,
            "eta":-1,
            "creation_time":1464340816,
            "edges":[

            ],
            "has_critical_tasks":false,
            "modification_time":1465367209,
            "version":0,
            "flow_type":null,
            "critical":false,
            "name":"Backup"
        }
    ],
    "dependencies":[

    ],
    "credentials":[
        {
            "username":"ubuntu",
            "public_key":"-----BEGIN CERTIFICATE-----\nMIID4zCCAsugAwIBAgIJAIToAW02xaWfMA0GCSqGSIb3DQEBCwUAMIGHMQswCQYD\nVQQGEwJJTjESMBAGA1UECAwJUmFqYXN0aGFuMRIwEAYDVQQHDAlCYW5nYWxvcmUx\nDzANBgNVBAoMBkNBTE1JTzEMMAoGA1UECwwDZGV2MQ8wDQYDVQQDDAZDQUxNSU8x\nIDAeBgkqhkiG9w0BCQEWEW1hZGh1bGlrYUBjYWxtLmlvMB4XDTE2MDMxNDExNDIw\nN1oXDTE3MDMxNDExNDIwN1owgYcxCzAJBgNVBAYTAklOMRIwEAYDVQQIDAlSYWph\nc3RoYW4xEjAQBgNVBAcMCUJhbmdhbG9yZTEPMA0GA1UECgwGQ0FMTUlPMQwwCgYD\nVQQLDANkZXYxDzANBgNVBAMMBkNBTE1JTzEgMB4GCSqGSIb3DQEJARYRbWFkaHVs\naWthQGNhbG0uaW8wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCbxmb8\nrMW5da4lPX+V71loE2DJeCSfmUfYYNyWMmtPoTkxhOprgQ6xhJ3bQZrlSGmnlFIU\n6akfT0xxM1m1KkiR2ouzX0HLAgG9Z2EvM0BwoG5ow9BtB9Avvi9DYe0dSB\/rOe1L\n7ZlJ67z67GGgzzWZSjtzZNZa9BDzJe6x0s4X8CLqzqcGIGNHHxSD\/eZhyh16l2W5\ntEnXotfbscEibpaGtMnaovJBMMrqnQmio7hJX+RFWZrf9NbnOXs2t+vIxIn86LSi\nxbCuhw68YMWjkSHJ29eKVopssue2vA6456I1n7PqfKCy35kEBRdeabZHpH3mAZVc\n70sMHb4zuAvE4f8PAgMBAAGjUDBOMB0GA1UdDgQWBBQeFNLnU1TsTZhLgXR3CXH1\nDxk1tzAfBgNVHSMEGDAWgBQeFNLnU1TsTZhLgXR3CXH1Dxk1tzAMBgNVHRMEBTAD\nAQH\/MA0GCSqGSIb3DQEBCwUAA4IBAQBXWMxief6slwSPzHMSMGJ3lVeEgBsn5nDE\nx60q4KZ0cZIjSU0O9R6zGGII8u0+G8TnDTjq7J5xVNyj+Y99huoWe7L7rVwfz\/2W\noulrp9jhw9BdSDIGEDaJVIkCgQxYVwGGP9N2Yocm0PUGXd5xh2+zBVvpoLhvuKaO\n6dIOos0xW1M2P+K53v+3QVstWRPDxPO6Kj9On0vF1R9PdYxWb3Giat2rkdUNvgHM\n6cfKKoWicz1OB1bmz8VkCoq\/zPKq4Yz2lefQoeSKGZw8ekiIzVpJ87I5UHymlf6R\nJZbo65IiSnBrGXBLGOW1BBNLoMzVg6WFqIsJHpXnY2BRTfjxrlRz\n-----END CERTIFICATE-----\n",
            "uid":"574414b20807a3fe5cbd8ed6",
            "classification":null,
            "secret_type":"ssh_key",
            "creation_time":1463661934,
            "modification_time":1465367209,
            "secret":null,
            "version":55,
            "name":"azure"
        }
    ],
    "bp_id":null,
    "properties":[
        {
            "uid":"57453dfd0807a37b9b584f8b",
            "classification":null,
            "editable":true,
            "value":"Pass@word1",
            "key":"DB_PASSWORD",
            "property_description":null,
            "property_type":"EXTERNAL",
            "setter":null
        },
        {
            "uid":"57453dfd0807a37b9b584f8c",
            "classification":null,
            "editable":true,
            "value":"sstuser",
            "key":"SST_USER",
            "property_description":null,
            "property_type":"EXTERNAL",
            "setter":null
        },
        {
            "uid":"57453dfd0807a37b9b584f8d",
            "classification":null,
            "editable":true,
            "value":"s3cret",
            "key":"SST_PASS",
            "property_description":null,
            "property_type":"EXTERNAL",
            "setter":null
        },
        {
            "uid":"57465a760807a3eb1d1d35e4",
            "classification":null,
            "editable":true,
            "value":"c5",
            "key":"CLUSTER_NAME",
            "property_description":null,
            "property_type":"EXTERNAL",
            "setter":null
        }
    ],
    "autoscale_enabled":false,
    "name":"PerconaCluster",
    "setup_ids":{

    },
    "h":0.0,
    "resiliency_config":{
        "post_flow":null,
        "cool_down_period":"1800",
        "alert_window":"1800",
        "classification":null,
        "alert_count":"1",
        "pre_flow":null,
        "listen_for":"internal",
        "uid":"573db4ad9acaaf75911eaae1"
    },
    "resiliency_enabled":false,
    "architecture":[
        {
            "tasks":[

            ],
            "uid":"cid:00000001",
            "classification":"compute",
            "address":"@@{public_ip_address}@@",
            "credential_id":null,
            "autoscale_config":{
                "post_flow":null,
                "cool_down_period":"1800",
                "uid":"57469bd60807a340fd2a5f67",
                "classification":null,
                "alert_count":"1",
                "max_count":"20",
                "pre_flow":null,
                "min_count":"1",
                "listen_for":"external",
                "scale_by":"1",
                "alert_window":"1800"
            },
            "cost":0.0,
            "strategy_enabled":false,
            "provider":"574414b20807a3fe5cbd8ed7",
            "service_type":"ssh",
            "config":{
                "setup":[

                ],
                "uid":"573db56e9acaaf75911eaf13",
                "classification":null,
                "deploy":[
                    "57453dfd0807a37b9b584f89",
                    "57453dfd0807a37b9b584f8a",
                    "57453e610807a37b9b584fe6"
                ]
            },
            "parent":"574414b20807a3fe5cbd8eda",
            "array_data":{
                "tasks":[

                ],
                "uid":"574414b20807a3fe5cbd8ee4",
                "classification":"array",
                "creation_time":1463661934,
                "policy_rules":[

                ],
                "autoscale_config":{
                    "post_flow":null,
                    "cool_down_period":"1800",
                    "uid":"573db56e9acaaf75911eaf0b",
                    "classification":null,
                    "alert_count":"1",
                    "max_count":"1",
                    "pre_flow":null,
                    "min_count":"1",
                    "listen_for":"external",
                    "scale_by":"1",
                    "alert_window":"1800"
                },
                "cost":0.0,
                "strategy_enabled":false,
                "version":55,
                "scale_down_task":null,
                "provider":null,
                "config":{
                    "scale_up":[

                    ],
                    "scale_down":[

                    ],
                    "uid":"573db56e9acaaf75911eaf0e",
                    "classification":null
                },
                "parent":"574414b20807a3fe5cbd8edb",
                "scale_up_task":null,
                "flows":[

                ],
                "modification_time":1465367209,
                "bp_id":"574414b20807a3fe5cbd8edb",
                "properties":[

                ],
                "count":"3",
                "autoscale_enabled":false,
                "name":"Percona_Cluster (Array)",
                "h":0.0,
                "resiliency_config":{
                    "post_flow":null,
                    "cool_down_period":"1800",
                    "alert_window":"1800",
                    "classification":null,
                    "alert_count":"1",
                    "pre_flow":null,
                    "listen_for":"internal",
                    "uid":"573db56e9acaaf75911eaf0c"
                },
                "resiliency_enabled":false,
                "w":0.0,
                "strategy_config":{
                    "post_flow":null,
                    "rollback_pre_flow":null,
                    "classification":null,
                    "rolling_factor":"100",
                    "initial_version":null,
                    "approval_flag":false,
                    "upgrade_flow":null,
                    "rollback_flow":null,
                    "pre_flow":null,
                    "rollback_post_flow":null,
                    "upgrade_type":"rolling_upgrade",
                    "uid":"573db56e9acaaf75911eaf0d",
                    "users":[

                    ],
                    "teams":[

                    ],
                    "emails":[

                    ],
                    "initial_count":"1"
                },
                "y":0.0,
                "x":0.0
            },
            "flows":[

            ],
            "dependencies":[

            ],
            "service_port":22,
            "bp_id":"574414b20807a3fe5cbd8edb",
            "properties":[

            ],
            "autoscale_enabled":true,
            "name":"Percona_Cluster",
            "h":0.0,
            "resiliency_config":{
                "post_flow":null,
                "cool_down_period":"1800",
                "alert_window":"1800",
                "classification":null,
                "alert_count":"1",
                "pre_flow":null,
                "listen_for":"external",
                "uid":"573db56e9acaaf75911eaf11"
            },
            "resiliency_enabled":true,
            "w":0.0,
            "strategy_config":{
                "post_flow":null,
                "rollback_pre_flow":null,
                "classification":null,
                "rolling_factor":"100",
                "initial_version":null,
                "approval_flag":false,
                "upgrade_flow":null,
                "rollback_flow":null,
                "pre_flow":null,
                "rollback_post_flow":null,
                "upgrade_type":"rolling_upgrade",
                "uid":"573db56e9acaaf75911eaf12",
                "users":[

                ],
                "teams":[

                ],
                "emails":[

                ],
                "initial_count":"1"
            },
            "y":100.0,
            "x":50.0,
            "os_type":"Linux"
        }
    ],
    "w":0.0,
    "strategy_config":{
        "post_flow":null,
        "rollback_pre_flow":null,
        "classification":null,
        "rolling_factor":"100",
        "initial_version":null,
        "approval_flag":false,
        "upgrade_flow":null,
        "rollback_flow":null,
        "pre_flow":null,
        "rollback_post_flow":null,
        "upgrade_type":"rolling_upgrade",
        "uid":"573db4ad9acaaf75911eaae2",
        "users":[

        ],
        "teams":[

        ],
        "emails":[

        ],
        "initial_count":"1"
    },
    "y":0.0,
    "x":0.0
}